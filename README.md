
# Overview

This application shows aeronautical data on Slovakia map:
- show obstacles based on coordinates and radius
- show obstacles based on airway and radius
- show roads based on airway and radius
- show aero data in airspace

This is it in action:

![Screenshot](Aero_data.png)

![Screenshot](Roads_for_route.png)
![Screenshot](Obstacles_for_route.png)
![Screenshot](Obstacles_for_route.png)


# Frontend

The frontend application is a static HTML page index.html, with basic CSS style.css.

Map is generated by leaflet.js widget, where I mainly use geojson method for writing layers on map. Map was generated by
mapbox where I achieved access token, also map style is mapbox.streets.

 Front end has sidebar menu and map. On sidebar there are 4 call with some fields and buttons.

 Front end code contains HTML definition of page with some onClick() methods, leading to AJAX call on Python server side.
 Also, there are some leaflet styles I use for difference between data.

# Backend

The backend is written  in Python Flask framework, which handles AJAX requests from page.

It renders index.html and also it host page on localhost:5000 . In backend I only create geoJSONs and also
I am using SQLalchemy to connect to postgis. Queries are based on execute methods.


## Data

Data are from http://go.freemap.sk/ which are Open street maps and I downloaded Slovakia dump.

Another source of data are custom made data on this site http://www.gmapgis.com/ .

## Queries

Queries are stored in sqls.sql file.

Example for Obstacle for route with custom LINESTRING, Limit is 200 for more optimal process
using ST_Contains with ST_Buffer where linestring gains buffer and then I am querying if osm points
are inside by contains
~~~~
-- obstacle for route
 select json_build_object('type', 'FeatureCollection','features', json_agg(features))
from (
     select 'Feature' as type, ST_AsGeoJSON(ST_Transform(pl.way,4326))::json as geometry,
     row_to_json((SELECT l FROM (SELECT osm_id AS feat_id) As l)) As properties
     from planet_osm_point as pl  where pl.natural = 'peak' and
     ST_Contains(
     ST_Buffer(
     ST_Transform(
     ST_GeomFromText('LINESTRING(20.86428 48.6602, 21.35468 48.68824)',4326)
     ,4326)::geometry,
      0.05), ST_Transform(pl.way, 4326)::geometry) limit 200 )as features;
~~~~

Example for obstacle for point with custom POINT, limit also 200 for optimal processing
Using this time DWithin, because I am only querying distance between points from osm points
~~~~
 -- obstacle for point
select json_build_object('type', 'FeatureCollection','features', json_agg(features))
    from (select 'Feature' as type, row_to_json((SELECT l FROM (SELECT osm_id AS feat_id) As l)) As properties,
    ST_AsGeoJSON(ST_Transform(pl.way, 4326))::json as geometry
    from planet_osm_point as pl  where pl.natural = 'peak' and
    ST_DWithin(
    ST_Transform(pl.way, 4326)::geography,
    ST_GeomFromText('POINT(19.759110 48.829909)',4326)::geography, 100000)
    limit 200) as features
~~~~

Example using custom Polygon  and pl.aeroway is not null to select only data which are aeronautical. Data are in other
osm also but i chosen polygon this time. Contains is used for bigger polygon of big airspace if it contains small object.
~~~~
-- aero data in polygon
 select json_build_object('type', 'FeatureCollection','features', json_agg(features))
from (
    select 'Feature' as type, ST_AsGeoJSON(ST_Transform(pl.way,4326))::json as geometry,
    row_to_json((SELECT l FROM (SELECT osm_id AS feat_id) As l)) As properties
    from planet_osm_polygon as pl
    where pl.aeroway is not null
    and ST_Contains(ST_Transform(ST_GeomFromText('POLYGON((16.94092 47.7541,18.02856 47.78363,19.22212
    47.97458,19.41086 49.29616,16.98937 49.57495,16.15215 48.70901,16.94092 47.7541))',4326),4326)::geometry,
     ST_Transform(pl.way, 4326)::geometry) )as features;

~~~~

Example using custom Linestring with Distance within this time. This operation can be better performed with other
 functions like contains or st intersect but I chosen this one to prove slow performance on this use case with bad used method
~~~~
SELECT json_build_object('type', 'FeatureCollection','features',json_agg(features))
    FROM (SELECT 'Feature' AS type,row_to_json((SELECT l FROM (SELECT osm_id AS feat_id) AS l)) AS properties,
    ST_AsGeoJSON(ST_Transform(way, 4326))::JSON AS geometry
    FROM planet_osm_roads AS pl
     WHERE ST_Dwithin(
     ST_Transform(ST_GeomFromText('LINESTRING(20.86428 48.6602, 21.35468 48.68824)', 4326),4326)::geography,
      ST_Transform(pl.way, 4326)::geography,  10 ) LIMIT 200 )AS features
~~~~

GEOJSON examples can be visible in data where are stored custom DATA